# Enable URL rewriting
RewriteEngine On

# Set the base directory
RewriteBase /ca/

# Prevent directory listing
Options -Indexes

# Protect sensitive files
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak|sql)$">
Order Allow,Deny
Deny from all
</FilesMatch>

# Allow access to the database directory only for local requests
# <Directory "database">
# Order Deny,Allow
# Deny from all
# Allow from 127.0.0.1
# Allow from ::1
# </Directory>

# Custom error pages
ErrorDocument 404 /ca/404.php
ErrorDocument 403 /ca/403.php

# PHP settings
<IfModule mod_php7.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# Add trailing slash to directories
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.*[^/])$ $1/ [R=301,L]

# Handle 404 errors for non-existent files
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ 404.php [L]